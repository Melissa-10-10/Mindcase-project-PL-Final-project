# Mindcase-project-PL-Final-project

# MindEase – Smart Mental Health Support and
Tracking System

## INTRODUTION

MindEase is a smart mental health support and tracking system that helps users monitor and
manage their emotional well-being. The platform allows users to log their moods, perform quick
self-assessments, and receive tailored recommendations to improve their mental health. It uses
data analysis to identify mood patterns and provide timely advice or professional guidance. This
system encourages early mental health awareness and self-care.



## BUSINESS PROCESS MODELING

![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/6f0ea6ae686bf4216f452c8746405ca571597ede/BPMN.jpg)

MindCase collects user mood data, validates login credentials, and stores all information in the database. The system retrieves the user’s mood history, analyzes emotional patterns, and generates personalized mental-health recommendations through its Recommendation Engine. These recommendations are then delivered back to the user. In high-risk cases, the system alerts a mental-health professional, who provides guidance that is sent directly to the user through the platform.

## LOGICAL MODEL DESIGN

```SQL
CREATE TABLE USER_T (
    USER_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USERNAME VARCHAR2(50) UNIQUE NOT NULL,
    PASSWORD_HASH VARCHAR2(255) NOT NULL,
    REGISTRATION_DATE DATE DEFAULT SYSDATE NOT NULL
);
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/0e399e7c024c732c618d0284caf6756878056c3d/user%20id%20erd.PNG)

```SQL
CREATE TABLE MOOD_LOG (
    LOG_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    MOOD_VALUE NUMBER(2, 1) CHECK (MOOD_VALUE BETWEEN 1.0 AND 10.0) NOT NULL,
    "TIMESTAMP" TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT FK_MOOD_USER FOREIGN KEY (USER_ID) REFERENCES USER_T(USER_ID)
);
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/410464fe0f6eeb2b7c5c56fad81ad4f46a6d0860/MOOD%20ERD.PNG)
```SQL
CREATE TABLE ASSESSMENT_SCORE (
    SCORE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    CALCULATED_SCORE NUMBER(5, 2) NOT NULL,
    EVALUATION_TIMESTAMP TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT FK_SCORE_USER FOREIGN KEY (USER_ID) REFERENCES USER_T(USER_ID)
);
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/190442abd006d0295258e4777d8caac86e4b4d11/NEW%20ASSESS%20ERD.PNG)
```SQL
CREATE TABLE MENTAL_HEALTH_RISK (
    RISK_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    RISK_LEVEL VARCHAR2(20) NOT NULL,
    GUIDANCE_CONTENT VARCHAR2(2000),
    EVALUATION_TIMESTAMP TIMESTAMP(6) DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT FK_RISK_USER FOREIGN KEY (USER_ID) REFERENCES USER_T(USER_ID)
);
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/2bdf969bfe89446670bd288e9c71f418b73eb7c4/NEW%20MENTAL%20ERD.PNG)

```SQL
CREATE TABLE RECOMMENDATION_T (
    REC_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    REC_TYPE VARCHAR2(50) UNIQUE NOT NULL,
    DESCRIPTION VARCHAR2(255)
);
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/74af5f28f76d4110a380afd1236332d921715658/recommendation%20erd.PNG)
```SQL
CREATE TABLE USER_RECOMMENDATION (
    USER_REC_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_ID NUMBER NOT NULL,
    REC_ID NUMBER NOT NULL,
    ASSIGNED_DATE DATE DEFAULT SYSDATE NOT NULL,
    CONSTRAINT FK_UR_USER FOREIGN KEY (USER_ID) REFERENCES USER_T(USER_ID),
    CONSTRAINT FK_UR_REC FOREIGN KEY (REC_ID) REFERENCES RECOMMENDATION_T(REC_ID)
);
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/05e7326cca1e3e97b2e8317c3859acaa3e6a3427/NEW%20USER%20ERD.PNG)


## DATABASE CREATION

Table space creation
Tablespaces act as logical containers that map to physical data files on disk, allowing for efficient organization and management of your application's data.

```SQL

CREATE TABLESPACE MINDCASES_DATA
DATAFILE 'MINDCASES_DATA01.dbf' 
SIZE 100M 
AUTOEXTEND ON NEXT 50M 
MAXSIZE 1000M;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/35255bb9ce26368b613ade36c16d1b5fb935262b/table%20space%20created.PNG)

Memory parameter creation
Memory parameters govern the memory areas of the Oracle instance, which directly affects the speed of data processing and transaction execution.

```sql
-- DDL to set the memory parameters
ALTER SYSTEM SET SGA_TARGET = 800M SCOPE=BOTH;
ALTER SYSTEM SET PGA_AGGREGATE_TARGET = 200M SCOPE=BOTH;
```
![image](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/fdca16ed70b187a40d2be3fa52c210c7fdd3277c/memory%20parameter.PNG)

### TESTING QUERIES

***SELECT***
```SQL
SELECT 'USER_T' AS Table_Name, COUNT(*) AS Row_Count FROM USER_T
UNION ALL
SELECT 'RECOMMENDATION_T', COUNT(*) FROM RECOMMENDATION_T
UNION ALL
SELECT 'MOOD_LOG', COUNT(*) FROM MOOD_LOG;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/a2a1f12771848cac7252e89744e848a5eedec130/select%20the%20queries.PNG)

![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/38012d50af485f47462315a3c51ed69a7db78d7b/testing%20select.PNG)

***JOIN***
```SQL
SELECT
    u.USERNAME,
    ml.MOOD_VALUE,
    ml."TIMESTAMP"
FROM 
    USER_T u 
JOIN 
    MOOD_LOG ml ON u.USER_ID = ml.USER_ID
WHERE 
    u.USERNAME = 'john_doe'
ORDER BY
    ml."TIMESTAMP" DESC
FETCH FIRST 10 ROWS ONLY;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/da2f38ca5b6c69ddb92d796591ee91adc368cf98/testing%20join%20in.PNG)

***GROUP BY***
```SQL
SELECT
    u.USERNAME,
    COUNT(ml.LOG_ID) AS Total_Mood_Logs,
    ROUND(AVG(ml.MOOD_VALUE), 2) AS Avg_Mood_Value
FROM
    USER_T u
LEFT JOIN
    MOOD_LOG ml ON u.USER_ID = ml.USER_ID
GROUP BY
    u.USERNAME
ORDER BY
    Avg_Mood_Value DESC;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/93ac95c3ec31a3d1cf5b6483ca3ccb89a6debffa/testing%20group%20by.PNG)

***SUBQUERIES***

```SQL
SELECT
    u.USERNAME,
    T1.User_Avg_Mood
FROM
    USER_T u
JOIN (
    -- T1: Subquery to calculate each user's average mood
    SELECT 
        USER_ID, 
        AVG(MOOD_VALUE) AS User_Avg_Mood
    FROM
        MOOD_LOG
    GROUP BY
        USER_ID
) T1 ON u.USER_ID = T1.USER_ID
WHERE
    T1.User_Avg_Mood < (
        -- Inner Subquery: Calculate the global average mood
        SELECT AVG(MOOD_VALUE) FROM MOOD_LOG
    )
ORDER BY
    T1.User_Avg_Mood;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/f6d03590b898d2ff05bac1b85e6c30c310ef3995/testing%20subqueries.PNG)

##DATABASE INTERACTION AND TRANSACTIONS

***PROCEDURES***

```SQL
create or replace PROCEDURE MOOD_ANALYSIS_PRC (
    p_user_id IN NUMBER,
    p_current_mood IN NUMBER
)
AS
    v_history_mood_avg NUMBER(5, 2);
    v_calculated_score NUMBER(5, 2);
    v_risk_level       VARCHAR2(20);
    v_rec_id           RECOMMENDATION_T.REC_ID%TYPE;
    v_guidance_content VARCHAR2(2000);

    -- Custom Exception Defined: Triggered if less than 3 logs are available
    low_historical_data EXCEPTION;
    PRAGMA EXCEPTION_INIT(low_historical_data, -20001); 
    v_log_count NUMBER;

BEGIN
    -- 1. Recovery Mechanism: Check historical log count (Need minimum 3 logs for robust analysis)
    SELECT COUNT(*) INTO v_log_count
    FROM MOOD_LOG
    WHERE USER_ID = p_user_id;

    IF v_log_count < 3 THEN
        -- Raise Custom Exception
        RAISE low_historical_data;
    END IF;

    -- 2. Predefined Exception Handling: Calculation (Uses a function that handles NO_DATA_FOUND)
    v_history_mood_avg := MINDCASES_API.calculate_historical_average(p_user_id => p_user_id);

    -- Weighted Score Calculation
    v_calculated_score := (p_current_mood * 0.40) + (v_history_mood_avg * 0.60);

    -- (REST OF THE PROCEDURE REMAINS THE SAME: Risk assessment and Insertion)

    -- Determine Risk Level and Guidance
    IF v_calculated_score <= 5.0 THEN
        v_risk_level := 'HIGH';
        v_guidance_content := 'High distress detected. Seeking immediate professional guidance recommended.';
        SELECT REC_ID INTO v_rec_id FROM RECOMMENDATION_T WHERE REC_TYPE = 'Meditation' FETCH FIRST 1 ROW ONLY;
    ELSE
        v_risk_level := 'LOW';
        v_guidance_content := 'Mood stable. Keep up the positive habits!';
        SELECT REC_ID INTO v_rec_id FROM RECOMMENDATION_T WHERE REC_TYPE = 'Article' FETCH FIRST 1 ROW ONLY;
    END IF;

    -- Insert records into Fact Tables
    INSERT INTO ASSESSMENT_SCORE (USER_ID, CALCULATED_SCORE) VALUES (p_user_id, v_calculated_score);
    INSERT INTO MENTAL_HEALTH_RISK (USER_ID, RISK_LEVEL, GUIDANCE_CONTENT) VALUES (p_user_id, v_risk_level, v_guidance_content);
    INSERT INTO USER_RECOMMENDATION (USER_ID, REC_ID) VALUES (p_user_id, v_rec_id);

EXCEPTION
    -- Catch Custom Exception
    WHEN low_historical_data THEN
        -- Error Logging Implemented
        INSERT INTO ERROR_LOG (PROCEDURE_NAME, USER_ID, ERROR_CODE, ERROR_MESSAGE)
        VALUES ('MOOD_ANALYSIS_PRC', p_user_id, '-20001', 'Insufficient historical data for reliable assessment.');
        COMMIT; 

    -- Catch Predefined Exceptions (E.g., NO_DATA_FOUND in SELECTs above, or DML errors)
    WHEN NO_DATA_FOUND THEN
        INSERT INTO ERROR_LOG (PROCEDURE_NAME, USER_ID, ERROR_CODE, ERROR_MESSAGE)
        VALUES ('MOOD_ANALYSIS_PRC', p_user_id, 'ORA-01403', 'Required reference data (e.g., Recommendation) not found.');
        COMMIT;
        -- Continue processing future logs (Recovery: Silent failure for this log)

    WHEN OTHERS THEN
        -- Catch All Other Errors
        INSERT INTO ERROR_LOG (PROCEDURE_NAME, USER_ID, ERROR_CODE, ERROR_MESSAGE)
        VALUES ('MOOD_ANALYSIS_PRC', p_user_id, SQLCODE, SUBSTR(SQLERRM, 1, 4000));
        COMMIT;
        -- Recovery: Log error and allow transaction to fail gracefully
        RAISE;
END MOOD_ANALYSIS_PRC;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/1b5accd3dd3affb1434332408728b3be8defff1d/FUNCTIONS.PNG)

***CURSOR***
```SQL
-- 2. Open and Fetch Loop (Fetching 1000 records at a time)
    OPEN C_LOGS_TO_ARCHIVE;
    LOOP
        FETCH C_LOGS_TO_ARCHIVE BULK COLLECT INTO v_logs_to_archive LIMIT 1000;

        EXIT WHEN v_logs_to_archive.COUNT = 0; -- Exit when no more records are fetched

        -- 3. Bulk DML (Archiving): Using FORALL
        FORALL i IN v_logs_to_archive.FIRST..v_logs_to_archive.LAST
            INSERT INTO MOOD_LOG_ARCHIVE (LOG_ID, USER_ID, MOOD_VALUE, "TIMESTAMP")
            VALUES (v_logs_to_archive(i).LOG_ID, v_logs_to_archive(i).USER_ID, 
                    v_logs_to_archive(i).MOOD_VALUE, v_logs_to_archive(i)."TIMESTAMP");
        
        -- 4. Bulk DML (Deletion): Using FORALL
        FORALL i IN v_logs_to_archive.FIRST..v_logs_to_archive.LAST
            DELETE FROM MOOD_LOG
            WHERE LOG_ID = v_logs_to_archive(i).LOG_ID;
            
        v_rows_deleted := v_rows_deleted + SQL%ROWCOUNT;
        
        -- Clear collection for next batch
        v_logs_to_archive.DELETE; 
        
    END LOOP;

    CLOSE C_LOGS_TO_ARCHIVE;
    -- ... COMMIT and output lines ...

EXCEPTION
    -- ... Exception handling logic ...
END archive_old_mood_logs;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/6a4feea2365334ba93770308c6767c49a1ed9da6/cursor.PNG)

***WINDOW FUNCTION***

```SQL
SELECT
    u.USERNAME,
    ml."TIMESTAMP",
    ml.MOOD_VALUE AS Current_Mood,
    LAG(ml.MOOD_VALUE, 1, 0) OVER (
        PARTITION BY ml.USER_ID 
        ORDER BY ml."TIMESTAMP"
    ) AS Previous_Mood,
    ml.MOOD_VALUE - LAG(ml.MOOD_VALUE, 1, 0) OVER (
        PARTITION BY ml.USER_ID 
        ORDER BY ml."TIMESTAMP"
    ) AS Mood_Change
FROM
    MOOD_LOG ml
JOIN
    USER_T u ON ml.USER_ID = u.USER_ID
ORDER BY
    u.USERNAME, ml."TIMESTAMP"
FETCH FIRST 10 ROWS ONLY;
```
![IMAGE](https://github.com/Melissa-10-10/Mindcase-project-PL-Final-project/blob/b71f07b26b8a52115b8c394c9057a50e20b48812/window%20lag.PNG0)
